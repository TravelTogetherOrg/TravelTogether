<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FestivalDAO">
			<!-- vo                db table -->
	<resultMap type="festival" id="festivalResult">
		<id property="festival_name" column="FESTIVAL_NAME"/>
		<result property="festival_startdate" column="FESTIVAL_STARTDATE"/>
		<result property="festival_enddate" column="FESTIVAL_ENDDATE"/>
		<result property="festival_address" column="FESTIVAL_ADDRESS"/>
		<result property="festival_detail_information" column="FESTIVAL_DETAIL_INFORMATION"/>
		<result property="festival_showaddress" column="FESTIVAL_SHOWADDRESS"/>
		<result property="festival_number" column="FESTIVAL_NUMBER"/>
		<result property="festival_latitude" column="FESTIVAL_LATITUDE"/>
		<result property="festival_longitude" column="FESTIVAL_LONGITUDE"/>
		<result property="festival_fee" column="FESTIVAL_FEE"/>
		<result property="festival_instagram_name" column="FESTIVAL_INSTAGRAM_NAME"/>
		<result property="festival_instagram_address" column="FESTIVAL_INSTAGRAM_ADDRESS"/>
		<result property="festival_homepage_address" column="FESTIVAL_HOMEPAGE_ADDRESS"/>
		
		<result property="like_no" column="LIKE_NO"/>
		<result property="member_id" column="MEMBER_ID"/>
		
		<result property="festival_file_1" column="FESTIVAL_FILE_1"/>
		<result property="festival_file_2" column="FESTIVAL_FILE_2"/>
		<result property="festival_file_3" column="FESTIVAL_FILE_3"/>
		<result property="festival_file_4" column="FESTIVAL_FILE_4"/>
		<result property="festival_file_5" column="FESTIVAL_FILE_5"/>
		<result property="festival_file_6" column="FESTIVAL_FILE_6"/>
	</resultMap>
	
	
	<!-- 전체검색 -->
	<select id="getFestivalList_Month_All" resultMap="festivalResult">
		SELECT *
		FROM festival as f1
		join festival_address as f2
			on f1.festival_name = f2.festival_name
		WHERE MONTH(CURDATE()) BETWEEN MONTH(festival_startdate) AND MONTH(festival_enddate);
	</select>
	
	<!-- 지역별로 보기 -->
	<select id="getFestivalList_Month" resultMap="festivalResult">
	  SELECT *
	  FROM festival as f1
	  JOIN festival_address as f2 ON f1.festival_name = f2.festival_name
	  WHERE MONTH(CURDATE()) BETWEEN MONTH(festival_startdate) AND MONTH(festival_enddate)
	    AND f1.festival_address LIKE CONCAT('%', #{festival_address}, '%');
	</select>
	

	
	<!-- 상세검색 -->
	<select id="getFestival" resultType="festival">
		select *
			from festival as f1
			join festival_address as f2
				on f1.festival_name = f2.FESTIVAL_NAME
			join festival_insta as f3
				on f1.festival_name = f3.FESTIVAL_NAME
			join festival_fee as f4
				on f1.festival_name = f4.festival_name
			where f1.festival_name = #{festival_name}
	</select>
	
	
	<!-- 페스티벌 게시물 좋아요 구현 -->
	<insert id="festival_Like" parameterType="festival">
		  INSERT INTO festival_like (festival_name, member_id)
  			VALUES (#{festival_name}, #{member_id})
	</insert>
	
	<delete id="festival_Delete_Like">
	  DELETE FROM festival_like a WHERE a.festival_name = #{festival_name} AND a.member_id = #{member_id}
	</delete>
	
	<!-- 페스티벌 게시물이 좋아요 눌려있는지 안눌려있는지 -->
	<select id="isFestival_Liked" resultType="festival">
		select count(*)
			from festival_like a
				where a.festival_name = #{festival_name} and a.member_id = #{member_id}
	</select>
	
	<!-- 해당 게시물 좋아요 수 -->
	<select id="getFestivalLikeCount" resultType="java.lang.Integer">
    	SELECT COUNT(*) FROM festival_like WHERE festival_name = #{festival_name}
	</select>

<!--  	<select id="isFestivalLiked" parameterType="java.util.Map" resultType="java.lang.Integer">
    SELECT COUNT(*) FROM festival_like WHERE member_id = #{memberId} AND festival_name = #{festivalName}
	</select> -->
	
	
</mapper>