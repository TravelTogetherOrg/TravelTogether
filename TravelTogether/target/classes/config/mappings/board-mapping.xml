<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardDAO">

	<resultMap type="board" id="boardResult">
		<id property="board_number" column="board_number"/>
		<result property="festival_name" column="festival_name"/>
		<result property="member_id" column="member_id"/>
		<result property="board_total_people" column="board_total_people"/>
		<result property="board_start_date" column="board_start_date"/>
		<result property="board_end_date" column="board_end_date"/>
		<result property="board_write_date" column="board_write_date"/>
		<result property="board_title" column="board_title"/>
		<result property="board_content" column="board_content"/>
		<result property="board_view_count" column="board_view_count"/>
		<result property="board_update_date" column="board_update_date"/>
	</resultMap>
	
	<resultMap type="boardLimit" id="BoardLimitResult">
		<id property="board_limit_number" column="board_limit_number"/>
		<result property="festival_name" column="festival_name"/>
		<result property="member_id" column="member_id"/>
		<result property="board_limit_count" column="board_limit_count"/>
	</resultMap>
	
	<resultMap type="boardImage" id="boardImageResult">
		<id property="board_number" column="board_number"/>
		<result property="board_image_file" column="board_image_file"/>
		<result property="board_image_file_path" column="board_image_file_path"/>
	</resultMap>
	
	<!-- board -->
	<insert id="insertBoard" useGeneratedKeys="true" keyProperty="board_number" parameterType="board">
		insert into board (festival_name, member_id, board_total_people, board_start_date, board_title, board_content)
			values(#{festival_name},#{member_id},${board_total_people},#{board_start_date},#{board_title},#{board_content});
	</insert>
	
	<update id="updateBoard">
		update board set board_title=#{board_title}, board_content=#{board_content}
			where board_number=${board_number}
	</update>
	
	<delete id="deleteBoard">
		delete from board where board_number = ${board_number}
	</delete>
	
	<select id="getOneBoard" resultType="board">
		select * from board where board_number = #{board_number}
	</select>
	
	<select id="getBoardList" resultMap="boardResult">
		select * from board order by board_number desc
	</select>
	
	<select id="getMemberBoardList" resultMap="boardResult">
		select * from board where member_id = #{member_id}
	</select>
	<!-- 페이징 -->
	<select id="getBoardListwithPaging" resultType="board">
		<![CDATA[
			select board_number, festival_name, member_id, board_start_date, board_title, board_content, board_view_count
			from (
				select @ROWNUM := @ROWNUM + 1 as rnum, board_number, festival_name, member_id, board_start_date, board_title, board_content, board_view_count
				from
				 board, (SELECT @ROWNUM :=0) A
				 ORDER BY board_number DESC
				 ) RESULT
			where rnum > (#{pageNumber} -1) * #{amount}
			LIMIT #{amount}
		]]>
	</select>
	<!-- 토탈 게시글 수 -->
	<select id="getTotalBoardCount" resultType="int">
		select count(*) from board;
	</select>
	
	<!-- boardLimit  -->
	<insert id="insertBoardLimit" parameterType="boardLimit">
		insert into board_limit (festival_name, member_id)
			values(#{festival_name},#{member_id})
	</insert>
	<update id="updateBoardLimit">
		update board_limit set board_limit_count = board_limit_count+1
			where festival_name = #{festival_name}
			and member_id = #{member_id}
	</update>
	<select id="getOneBoardLimit" resultType="boardLimit">
		select * from board_limit 
		where festival_name = #{festival_name}
			and member_id = #{member_id}
	</select>
	<select id="boardLimitCheck" parameterType="String" resultType="int">
		select board_limit_count from board_limit
		where festival_name = #{festival_name}
			and member_id = #{member_id}
	</select>
	
	<!-- board_image -->
	<insert id="insertBoardImage">
		insert into board_image values(${board_number},#{board_image_file},#{board_image_file_path})
	</insert>
	<select id="getOneboardIamge" resultType="boardImage">
		select * from board_image
		where board_number = ${board_number}
	</select>

</mapper>
